/*
 # -----------------------------------------------------------------------------
 # ~/assets/themes/j1/modules/lightGallery/js/plugins/lg-video.js
 # Provides lightGallery JS code for the plugin lgVideo
 #
 # Product/Info:
 # https://jekyll.one
 #
 # Copyright (C) 2023 Sachin Neravath
 # Copyright (C) 2023, 2024 Juergen Adams
 #
 # J1 Template is licensed under the MIT License.
 # See: https://github.com/jekyll-one-org/j1-template/blob/main/LICENSE.md
 # lightGallery is licensed under the GPLv3 license
 # See: https://github.com/sachinchoolur/lightGallery/blob/master/LICENSE
 # -----------------------------------------------------------------------------
*/

/*!
 * lightgallery | 2.7.2 | September 20th 2023
 * http://www.lightgalleryjs.com/
 * Copyright (c) 2020 Sachin Neravath;
 * @license GPLv3
 */
  !function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).lgVideo=t()}(this,function(){"use strict";
  var e=new URL(window.location.href).origin,t=function(){return(t=Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},i={autoplayFirstVideo:!0,htmlPlayerParams:!1,youTubePlayerParams:!1,vimeoPlayerParams:!1,dailymotionPlayerParams:!1,wistiaPlayerParams:!1,tiktokPlayerParams:!1,gotoNextSlideOnVideoEnd:!0,autoplayVideoOnSlide:!1,videojs:!1,videojsTheme:"",videojsOptions:{}},o="lgHasVideo",s="lgSlideItemLoad",n="lgBeforeSlide",r="lgAfterSlide",a="lgPosterClick",l=function(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")},d=function(i,o){if(!i.youtube)return"";var s=i.youtube[2]?i.youtube[2].slice(1).split("&").map(function(e){return e.split("=")}).reduce(function(e,t){var i=t.map(decodeURIComponent),o=i[0],s=i[1];return e[o]=s,e},{}):"",n=o||{},r=t(t(t({},{autoplay:0,controls:1,enablejsapi:1,hl:"en",loop:0,mute:1,wmode:"opaque",origin:e}),n),s);return"?"+l(r)};return function(){function e(e){return this.core=e,this.settings=t(t({},i),this.core.settings),this}return e.prototype.init=function(){var e=this;this.core.LGel.on(o+".video",this.onHasVideo.bind(this)),this.core.LGel.on(a+".video",function(){var t=e.core.getSlideItem(e.core.index);e.loadVideoOnPosterClick(t)}),this.core.LGel.on(s+".video",this.onSlideItemLoad.bind(this)),this.core.LGel.on(n+".video",this.onBeforeSlide.bind(this)),this.core.LGel.on(r+".video",this.onAfterSlide.bind(this))},e.prototype.onSlideItemLoad=function(e){var t=this,i=e.detail,o=i.isFirstSlide,s=i.index;this.settings.autoplayFirstVideo&&o&&s===this.core.index&&setTimeout(function(){t.loadAndPlayVideo(s)},200),!o&&this.settings.autoplayVideoOnSlide&&s===this.core.index&&this.loadAndPlayVideo(s)},e.prototype.onHasVideo=function(e){var t=e.detail,i=t.index,o=t.src,s=t.html5Video;if(t.hasPoster)this.core.getSlideItem(i);else this.appendVideos(this.core.getSlideItem(i),{src:o,addClass:"lg-object",index:i,html5Video:s}),this.gotoNextSlideOnVideoEnd(o,i)},e.prototype.onBeforeSlide=function(e){if(this.core.lGalleryOn){var t=e.detail.prevIndex;this.pauseVideo(t)}},e.prototype.onAfterSlide=function(e){var t=this,i=e.detail,o=i.index,s=i.prevIndex,n=this.core.getSlideItem(o);this.settings.autoplayVideoOnSlide&&o!==s&&n.hasClass("lg-complete")&&setTimeout(function(){t.loadAndPlayVideo(o)},100)},e.prototype.loadAndPlayVideo=function(e){var t=this.core.getSlideItem(e);this.core.galleryItems[e].poster?this.loadVideoOnPosterClick(t,!0):this.playVideo(e)},e.prototype.playVideo=function(e){this.controlVideo(e,"play")},e.prototype.pauseVideo=function(e){this.controlVideo(e,"pause")},e.prototype.getVideoHtml=function(e,t,i,o){var s="",n=this.core.galleryItems[i].__slideVideoInfo||{},r=this.core.galleryItems[i],a=r.title||r.alt;a=a?'title="'+a+'"':"";var c='allowtransparency="true"\n            frameborder="0"\n            scrolling="no"\n            allowfullscreen\n            mozallowfullscreen\n            webkitallowfullscreen\n            msallowfullscreen';if(n.youtube){var u="lg-youtube"+i,f=d(n,this.settings.youTubePlayerParams);s='<iframe allow="autoplay" id='+u+' class="lg-video-object lg-youtube '+t+'" '+a+' src="'+(e.includes("youtube-nocookie.com")?"//www.youtube-nocookie.com/":"//www.youtube.com/")+"embed/"+(n.youtube[1]+f)+'" '+c+"></iframe>"}else if(n.vimeo){u="lg-vimeo"+i;var h=function(e,t){if(!t||!t.vimeo)return"";var i=t.vimeo[2]||"",o=e&&0!==Object.keys(e).length?"&"+l(e):"",s=((t.vimeo[0].split("/").pop()||"").split("?")[0]||"").split("#")[0],n=t.vimeo[1]!==s;return n&&(i=i.replace("/"+s,"")),"?autoplay=0&muted=1"+(n?"&h="+s:"")+o+(i="?"==i[0]?"&"+i.slice(1):i||"")}(this.settings.vimeoPlayerParams,n);s='<iframe allow="autoplay" id='+u+' class="lg-video-object lg-vimeo '+t+'" '+a+' src="//player.vimeo.com/video/'+(n.vimeo[1]+h)+'" '+c+"></iframe>"}else if(n.wistia){var m="lg-wistia"+i;h=(h=l(this.settings.wistiaPlayerParams))?"?"+h:"",s='<iframe allow="autoplay" id="'+m+'" src="//fast.wistia.net/embed/iframe/'+(n.wistia[4]+h)+'" '+a+' class="wistia_embed lg-video-object lg-wistia '+t+'" name="wistia_embed" '+c+"></iframe>"}else if(n.dailymotion){var v="lg-dailymotion"+i;h=(h=l(this.settings.dailymotionPlayerParams))?"?"+h:"",s='<iframe allow="autoplay" id="'+v+'" src="//www.dailymotion.com/embed/video/'+(n.dailymotion[1]+h)+'" '+a+' class="dailymotion_embed lg-video-object lg-dailymotion '+t+'" name="dailymotion_embed" '+c+"></iframe>"}else if(n.tiktoc){h=function(e,t){if(!t||!t.tiktok)return"";var i=t.tiktok[2]||"",o=e&&0!==Object.keys(e).length?"&"+l(e):"",s=((t.tiktok[0].split("/").pop()||"").split("?")[0]||"").split("#")[0];return t.tiktok[1]!==s&&(i=i.replace("/"+s,"")),"?autoplay=0&muted=1"+o+(i="?"==i[0]?"&"+i.slice(1):i||"")}(this.settings.TicTocPlayerParams);s='<iframe allow="autoplay" id='+u+' class="lg-video-object lg-tictoc '+t+'" '+a+' src="//tiktok.com/embed/'+n.tiktoc[1]+'" '+a+c+"></iframe>"}else if(n.html5){for(var g="",p=0;p<o.source.length;p++)g+='<source src="'+o.source[p].src+'" type="'+o.source[p].type+'">';if(o.tracks){var y=function(e){var t="",i=o.tracks[e];Object.keys(i||{}).forEach(function(e){t+=e+'="'+i[e]+'" '}),g+="<track "+t+">"};for(p=0;p<o.tracks.length;p++)y(p)}var w="",b=o.attributes||{};Object.keys(b||{}).forEach(function(e){w+=e+'="'+b[e]+'" '}),s='<video class="lg-video-object lg-html5 '+(this.settings.videojs&&this.settings.videojsTheme?this.settings.videojsTheme+" ":"")+" "+(this.settings.videojs?" video-js":"")+'" '+w+">\n                "+g+"\n                Your browser does not support HTML5 video.\n            </video>"}return s},e.prototype.appendVideos=function(e,t){var i,o=this.getVideoHtml(t.src,t.addClass,t.index,t.html5Video);e.find(".lg-video-cont").append(o);var s=e.find(".lg-video-object").first();if(t.html5Video&&s.on("mousedown.lg.video",function(e){e.stopPropagation()}),this.settings.videojs&&(null===(i=this.core.galleryItems[t.index].__slideVideoInfo)||void 0===i?void 0:i.html5))try{return videojs(s.get(),this.settings.videojsOptions)}catch(e){console.warn("lightGallery: Make sure you have included videojs")}},e.prototype.gotoNextSlideOnVideoEnd=function(e,t){var i=this,o=this.core.getSlideItem(t).find(".lg-video-object").first(),s=this.core.galleryItems[t].__slideVideoInfo||{};if(this.settings.gotoNextSlideOnVideoEnd)if(s.html5)o.on("ended",function(){i.core.goToNextSlide()});else if(s.vimeo)try{new Vimeo.Player(o.get()).on("ended",function(){i.core.goToNextSlide()})}catch(e){console.warn("lightGallery: Make sure you have included //github.com/vimeo/player.js")}else if(s.wistia)try{window._wq=window._wq||[],window._wq.push({id:o.attr("id"),onReady:function(e){e.bind("end",function(){i.core.goToNextSlide()})}})}catch(e){console.warn("lightGallery: Make sure you have included //fast.wistia.com/assets/external/E-v1.js")}},e.prototype.controlVideo=function(e,i){var o,s,n,r,a,l,d,c=!1;if(n=this.core.galleryItems[e].__slideVideoInfo||{},s=this.core.getSlideItem(e).find(".lg-video-object").first(),void 0!==this.core.galleryItems[this.core.index].video&&n.html5){if(void 0!==(a=JSON.parse(this.core.galleryItems[this.core.index].video)).tracks&&a.tracks.length>0)for(var u=0;u<a.tracks.length;u++)"chapters"==a.tracks[u].kind&&(o=a.tracks[u].src,c=!0);var f;l=s.selector.id,d=videojs(l),void 0!==(f=this.settings.videojsOptions.zoomPlugin)&&this.settings.videojsOptions.videoStart&&(r=this.settings.videojsOptions.videoStart[e],d.on("play",function(){var e=new Date("1970-01-01T"+r+"Z").getTime()/1e3;d.currentTime(e)})),void 0!==f&&f.enabled&&(f.settings=t(t({},{moveX:0,moveY:0,rotate:0,zoom:1}),f.options),d.zoomPlugin({moveX:f.settings.moveX,moveY:f.settings.moveY,rotate:f.settings.rotate,zoom:f.settings.zoom}))}if(c){var h=new WebVTTParser,m=[];!function(e,t){new WebVTTParser;$.ajax({url:e,type:"GET",success:t,error:function(e){JSON.stringify(e,void 0,2)}})}(o,function(e){for(var t,i=h.parse(e,"metadata"),o=0;o<i.cues.length;o++)t={time:i.cues[o].startTime,label:i.cues[o].text},m.push(t)}),d.on("play",function(){d.currentTime(r);var e=d.duration(),t=$(d.controlBar.progressControl.children_[0].el_);setTimeout(function(){var i=setInterval(function(){if(m.length){for(var o=0;o<m.length;o++){var s=m[o].time/e*100+"%",n=m[o].time,r=$('<div class="vjs-chapter-marker" style="left: '+s+'" data-time="'+n+'"> <span>'+m[o].label+"</span></div>");r.click(function(){d.currentTime($(this).data("time"))}),t.append(r)}clearInterval(i)}},10)},1e3)})}if(s.get())if(n.youtube)try{s.get().contentWindow.postMessage('{"event":"command","func":"'+i+'Video","args":""}',"*")}catch(e){console.error("lightGallery:- "+e)}else if(n.vimeo)try{new Vimeo.Player(s.get())[i]()}catch(e){console.warn("lightGallery: Make sure you have included //github.com/vimeo/player.js")}else if(n.html5)if(this.settings.videojs)try{videojs(s.get())[i]()}catch(e){console.warn("lightGallery: Make sure you have included videojs")}else s.get()[i]();else if(n.wistia)try{window._wq=window._wq||[],window._wq.push({id:s.attr("id"),onReady:function(e){e[i]()}})}catch(e){console.warn("lightGallery: Make sure you have included //fast.wistia.com/assets/external/E-v1.js")}},e.prototype.loadVideoOnPosterClick=function(e,t){var i=this;if(e.hasClass("lg-video-loaded"))t&&this.playVideo(this.core.index);else if(e.hasClass("lg-has-video"))this.playVideo(this.core.index);else{e.addClass("lg-has-video");var o=void 0,s=this.core.galleryItems[this.core.index].src,n=this.core.galleryItems[this.core.index].video;n&&(o="string"==typeof n?JSON.parse(n):n);var r=this.appendVideos(e,{src:s,addClass:"",index:this.core.index,html5Video:o});this.gotoNextSlideOnVideoEnd(s,this.core.index);var a=e.find(".lg-object").first().get();e.find(".lg-video-cont").first().append(a),e.addClass("lg-video-loading"),r&&r.ready(function(){r.on("loadedmetadata",function(){i.onVideoLoadAfterPosterClick(e,i.core.index)})}),e.find(".lg-video-object").first().on("load.lg error.lg loadedmetadata.lg",function(){setTimeout(function(){i.onVideoLoadAfterPosterClick(e,i.core.index)},50)})}},e.prototype.onVideoLoadAfterPosterClick=function(e,t){e.addClass("lg-video-loaded"),this.playVideo(t)},e.prototype.destroy=function(){this.core.LGel.off(".lg.video"),this.core.LGel.off(".video")},e}()});

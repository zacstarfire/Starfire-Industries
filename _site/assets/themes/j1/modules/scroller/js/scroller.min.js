/*
 # -----------------------------------------------------------------------------
 # ~/assets/themes/j1/modules//js/scroller.min.js
 # J1 core module for scroller
 #
 # Product/Info:
 # https://jekyll.one
 #
 # Copyright (C) 2023, 2024 Juergen Adams
 #
 # J1 Template is licensed under the MIT License.
 # For details, see: https://github.com/jekyll-one-org/j1-template/blob/main/LICENSE.md
 # -----------------------------------------------------------------------------
*/
!function(e,t,n,i){"use strict";var s={type:"infiniteScroll",scrollOffset:100,elementScroll:!1,firstPage:2,lastPage:!1,infoLastPage:!1,loadStatus:!1,onInit:function(){},onBeforeLoad:function(){},onAfterLoad:function(){}};function o(t,n){this.element=t,this.settings=e.extend({},s,n),this.settings.elementID="#"+this.element.id,this.init(this.settings)}e.extend(o.prototype,{init:function(n){var i=log4javascript.getLogger("j1.scroller.core"),s=this;i.debug("\ninitializing plugin: started"),i.debug("\nstate: started"),n.elementScroll?s.scroller=s.element:s.scroller=t;var o=setInterval(function(){var t="block"===e("#content").css("display");"finished"===j1.getState()&&t&&("infiniteScroll"===n.type&&(i.debug("\nprocessing mode: "+n.type),i.debug("\nloading items from path: "+n.pagePath),i.debug("\nmonitoring element set to: "+s.scroller),s.registerScrollEvent(n)),"showOnScroll"===n.type&&(i.debug("\nprocessing mode: "+n.type),i.debug("\nloading items from path: "+n.pagePath),i.debug("\nmonitoring element set to: "+s.scroller),s.registerScrollEvent(n)),i.debug("\ninitializing plugin: finished"),i.debug("\nstate: finished"),clearInterval(o))},25)},isInViewport:function(e,n){if(0!=e.length){var i=jQuery(t),s=i.scrollTop(),o=i.height(),r=s+o,l=jQuery(e),a=l.offset().top+n,d=l.height(),g=a+d;return a>=s&&a<r||g>s&&g<=r||d>o&&a<=s&&g>=r}},isBottomReached:function(i){var s,o=e(i.elementID).height();if(this.settings.elementScroll){var r=e(t),l=r.scrollTop(),a=r.height(),d=l+a-i.scrollOffset,g=e(i.elementID),c=g.offset().top+o,u=g.height();return s=c+u,c>=l&&c<d||s>l&&s<=d||u>a&&c<=l&&s>=d}return t.innerHeight+t.pageYOffset+i.scrollOffset>=n.body.offsetHeight},registerScrollEvent:function(n){var i=log4javascript.getLogger("j1.scroller.core"),s=this;"infiniteScroll"===n.type&&(s[n.id]=function(e){var n=s.settings;if(s.isBottomReached(n)){if(n.firstPage>n.lastPage)return t.removeEventListener("scroll",s[n.id]),i.debug("\nscroll event removed: "+n.type),n.infoLastPage&&(i.debug("\nshow last page info"),s.infoLastPage(n)),!1;s.getNewPost(n)}},t.addEventListener("scroll",s[n.id]),i.debug("\nscroll event registered: "+n.type)),"showOnScroll"===n.type&&(s[n.id]=function(o){s.isInViewport(e("#"+n.id),n.scrollOffset)&&(i.debug("\nspecified container is in view: "+n.id),e("."+n.id).show(n.showDelay),t.removeEventListener("scroll",s[n.id]),i.debug("\nscroll event showOnScroll: removed"))},t.addEventListener("scroll",s[n.id]),i.debug("\nscroll event registered: "+n.type))},getNewPost:function(t){var n=log4javascript.getLogger("j1.scroller.core"),i=this;if(n.debug("\nloading new posts"),!1===this.itemsLoaded)return!1;this.itemsLoaded=!1,t.loadStatus&&(n.debug("\nshow: spinner"),e(".loader-ellips").show());var s=new XMLHttpRequest;s.onreadystatechange=function(){if(s.readyState==XMLHttpRequest.DONE)if(200==s.status){t.firstPage++;var o=i.getChildItemsByAjaxHTML(t,s.responseText);i.appendNewItems(o),n.debug("\nloading new items: successful"),t.loadStatus&&(n.debug("\nhide: spinner"),e(".loader-ellips").hide()),i.itemsLoaded=!0}else t.loadStatus&&(n.debug("\nhide: spinner"),e(".loader-ellips").hide()),n.error("\nloading new items failed, HTTP response: "+s.status),i.itemsLoaded=!1},n.debug("\nloading new items from path: "+t.pagePath+t.firstPage),s.open("GET",location.origin+t.pagePath+t.firstPage+"/index.html",!0),s.send()},getChildItemsByAjaxHTML:function(e,t){var i=log4javascript.getLogger("j1.scroller.core"),s=n.createElement("html");return i.debug("\nload new items"),s.innerHTML=t,s.querySelectorAll(e.elementID+" > *")},appendNewItems:function(e){var t=log4javascript.getLogger("j1.scroller.core"),i=this,s=j1.getCookieNames(),o=j1.readCookie(s.user_translate);e.forEach(function(e){var s=i.element.id;n.getElementById(s).appendChild(e),t.debug("\nnew item appended")}),o.translationEnabled?(t.debug("\ntranslation enabled: "+o.translationEnabled),t.debug("\nskipped processing of dropcaps")):(t.debug("\npost processing: createDropCap"),j1.core.createDropCap())},infoLastPage:function(t){var n=t.lastPageInfo;e(n).insertAfter(t.elementID),e(".page-scroll-last").show()}}),e.fn.scroller=function(t){return this.each(function(){e.data(this,"plugin_scroller")||e.data(this,"plugin_scroller",new o(this,t))})}}(jQuery,window,document);

/*
 # -----------------------------------------------------------------------------
 # ~/assets/themes/j1/modules/dropdowns/js/dropdowns.min.js
 # MODIFIED DROPDOWN JS from project Materialize
 # Provides JS Core funtions for the J1 DROPDOWNS Module
 #
 # Product/Info:
 # https://jekyll.one
 # https://github.com/Dogfalo/materialize
 #
 # Copyright (C) 2023, 2024 Juergen Adams
 #
 # J1 Template is licensed under the MIT License.
 # See: https://github.com/jekyll-one-org/j1-template/blob/main/LICENSE.md
 # -----------------------------------------------------------------------------
 # TODO:
 # jadams, 2020-10-11: module needs to be rewitten to PURE jQuery
 # -----------------------------------------------------------------------------
*/
"use strict";!function(e,t){var i={direction:"top",hoverEnabled:!0,toolbarEnabled:!1};e.fn.reverse=[].reverse;class o{constructor(e,t,i){t instanceof Element||console.error(Error(t+" is not an HTML Element"));var o=e.getInstance(t);o&&o.destroy(),this.el=t,this.$el=cash(t)}static init(e,t,i){var o=null;if(t instanceof Element)o=new e(t,i);else if(t&&(t.jquery||t.cash||t instanceof NodeList)){for(var n=[],s=0;s<t.length;s++)n.push(new e(t[s],i));o=n}return o}}j1.initializeJqueryWrapper=function(e,t,i){jQuery.fn[t]=function(o){if(e.prototype[o]){var n=Array.prototype.slice.call(arguments,1);if("get"===o.slice(0,3)){var s=this.first()[0][i];return s[o].apply(s,n)}return this.each(function(){var e=this[i];e[o].apply(e,n)})}if("object"==typeof o||!o)return e.init(this,arguments[0]),this;jQuery.error("Method "+o+" does not exist on jQuery."+t)}};class n extends o{constructor(t,i){super(n,t,i),this.el.M_Dropdown=this,n._dropdowns.push(this),this.id=this.getIdFromTrigger(t),this.dropdownEl=document.getElementById(this.id),this.$dropdownEl=e(this.dropdownEl),this.options=e.extend({},n.defaults,i),this.isOpen=!1,this.isScrollable=!1,this.isTouchMoving=!1,this.focusedIndex=-1,this.filterQuery=[],this.keys={TAB:9,ENTER:13,ESC:27,ARROW_UP:38,ARROW_DOWN:40},this.options.container?e(this.options.container).append(this.dropdownEl):this.$el.after(this.dropdownEl),this._makeDropdownFocusable(),this._resetFilterQueryBound=this._resetFilterQuery.bind(this),this._handleDocumentClickBound=this._handleDocumentClick.bind(this),this._handleDocumentTouchmoveBound=this._handleDocumentTouchmove.bind(this),this._handleDropdownClickBound=this._handleDropdownClick.bind(this),this._handleDropdownKeydownBound=this._handleDropdownKeydown.bind(this),this._handleTriggerKeydownBound=this._handleTriggerKeydown.bind(this),this._setupEventHandlers()}static get defaults(){return i}static init(e,t){return super.init(this,e,t)}static getInstance(e){return(e.jquery?e[0]:e).M_Dropdown}getIdFromTrigger(e){var t=e.getAttribute("data-target");return t||(t=(t=e.getAttribute("href"))?t.slice(1):""),t}executeFunctionByName(e,t){for(var i=Array.prototype.slice.call(arguments,2),o=e.split("."),n=o.pop(),s=0;s<o.length;s++)t=t[o[s]];return t[n].apply(t,i)}checkPossibleAlignments(e,t,i,o){var n={top:!0,right:!0,bottom:!0,left:!0,spaceOnTop:null,spaceOnRight:null,spaceOnBottom:null,spaceOnLeft:null},s="visible"===getComputedStyle(t).overflow,h=t.getBoundingClientRect(),d=Math.min(h.height,window.innerHeight),r=Math.min(h.width,window.innerWidth),l=e.getBoundingClientRect(),a=t.scrollLeft,c=t.scrollTop,p=i.left-a,u=i.top-c,w=i.top+l.height-c;return n.spaceOnRight=s?window.innerWidth-(l.left+i.width):r-(p+i.width),n.spaceOnRight<0&&(n.left=!1),n.spaceOnLeft=s?l.right-i.width:p-i.width+l.width,n.spaceOnLeft<0&&(n.right=!1),n.spaceOnBottom=s?window.innerHeight-(l.top+i.height+o):d-(u+i.height+o),n.spaceOnBottom<0&&(n.top=!1),n.spaceOnTop=s?l.bottom-(i.height+o):w-(i.height-o),n.spaceOnTop<0&&(n.bottom=!1),n}destroy(){this._resetDropdownStyles(),this._removeEventHandlers(),n._dropdowns.splice(n._dropdowns.indexOf(this),1),this.el.M_Dropdown=void 0}_setupEventHandlers(){this.el.addEventListener("keydown",this._handleTriggerKeydownBound),this.dropdownEl.addEventListener("click",this._handleDropdownClickBound),this.options.hover?(this._handleMouseEnterBound=this._handleMouseEnter.bind(this),this.el.addEventListener("mouseenter",this._handleMouseEnterBound),this._handleMouseLeaveBound=this._handleMouseLeave.bind(this),this.el.addEventListener("mouseleave",this._handleMouseLeaveBound),this.dropdownEl.addEventListener("mouseleave",this._handleMouseLeaveBound)):(this._handleClickBound=this._handleClick.bind(this),this.el.addEventListener("click",this._handleClickBound))}_removeEventHandlers(){this.el.removeEventListener("keydown",this._handleTriggerKeydownBound),this.dropdownEl.removeEventListener("click",this._handleDropdownClickBound),this.options.hover?(this.el.removeEventListener("mouseenter",this._handleMouseEnterBound),this.el.removeEventListener("mouseleave",this._handleMouseLeaveBound),this.dropdownEl.removeEventListener("mouseleave",this._handleMouseLeaveBound)):this.el.removeEventListener("click",this._handleClickBound)}_setupTemporaryEventHandlers(){document.body.addEventListener("click",this._handleDocumentClickBound,!0),document.body.addEventListener("touchend",this._handleDocumentClickBound),document.body.addEventListener("touchmove",this._handleDocumentTouchmoveBound),this.dropdownEl.addEventListener("keydown",this._handleDropdownKeydownBound)}_removeTemporaryEventHandlers(){document.body.removeEventListener("click",this._handleDocumentClickBound,!0),document.body.removeEventListener("touchend",this._handleDocumentClickBound),document.body.removeEventListener("touchmove",this._handleDocumentTouchmoveBound),this.dropdownEl.removeEventListener("keydown",this._handleDropdownKeydownBound)}_handleClick(e){e.preventDefault(),this.open()}_handleMouseEnter(){this.open()}_handleMouseLeave(t){let i=t.toElement||t.relatedTarget,o=!!e(i).closest(".dropdown-content").length,n=!1,s=e(i).closest(".dropdowns");s.length&&s[0].M_Dropdown&&s[0].M_Dropdown.isOpen&&(n=!0),n||o||this.close()}_handleDocumentClick(t){let i=e(t.target);this.options.closeOnClick&&i.closest(".dropdown-content").length&&!this.isTouchMoving?setTimeout(()=>{this.close()},0):!i.closest(".dropdowns").length&&i.closest(".dropdown-content").length||setTimeout(()=>{this.close()},0),this.isTouchMoving=!1}_handleTriggerKeydown(e){e.which!==this.keys.ARROW_DOWN&&e.which!==this.keys.ENTER||this.isOpen||(e.preventDefault(),this.open())}_handleDocumentTouchmove(t){e(t.target).closest(".dropdown-content").length&&(this.isTouchMoving=!0)}_handleDropdownClick(e){if("false"!==this.options.onItemClick){this.executeFunctionByName(this.options.onItemClick,window,this)}}_handleDropdownKeydown(t){if(t.which===this.keys.TAB)t.preventDefault(),this.close();else if(t.which!==this.keys.ARROW_DOWN&&t.which!==this.keys.ARROW_UP||!this.isOpen)if(t.which===this.keys.ENTER&&this.isOpen){let t=this.dropdownEl.children[this.focusedIndex],i=e(t).find("a, button").first();i.length?i[0].click():t&&t.click()}else t.which===this.keys.ESC&&this.isOpen&&(t.preventDefault(),this.close());else{t.preventDefault();let e=t.which===this.keys.ARROW_DOWN?1:-1,i=this.focusedIndex,o=!1;do{if(i+=e,this.dropdownEl.children[i]&&-1!==this.dropdownEl.children[i].tabIndex){o=!0;break}}while(i<this.dropdownEl.children.length&&i>=0);o&&(this.focusedIndex=i,this._focusFocusedItem())}let i=String.fromCharCode(t.which).toLowerCase();if(i&&-1===[9,13,27,38,40].indexOf(t.which)){this.filterQuery.push(i);let t=this.filterQuery.join(""),o=e(this.dropdownEl).find("li").filter(i=>0===e(i).text().toLowerCase().indexOf(t))[0];o&&(this.focusedIndex=e(o).index(),this._focusFocusedItem())}this.filterTimeout=setTimeout(this._resetFilterQueryBound,1e3)}_resetFilterQuery(){this.filterQuery=[]}_resetDropdownStyles(){this.$dropdownEl.css({display:"",width:"",height:"",left:"",top:"","transform-origin":"",transform:"",opacity:""})}_makeDropdownFocusable(){this.dropdownEl.tabIndex=0,e(this.dropdownEl).children().each(function(e){e.getAttribute("tabindex")||e.setAttribute("tabindex",0)})}_focusFocusedItem(){this.focusedIndex>=0&&this.focusedIndex<this.dropdownEl.children.length&&this.options.autoFocus&&this.dropdownEl.children[this.focusedIndex].focus()}_getDropdownPosition(){this.el.offsetParent.getBoundingClientRect();let e=this.el.getBoundingClientRect(),t=this.dropdownEl.getBoundingClientRect(),i=t.height,o=t.width,n=e.left-t.left,s=e.top-t.top,h={left:n,top:s,height:i,width:o},d=this.dropdownEl.offsetParent?this.dropdownEl.offsetParent:this.dropdownEl.parentNode,r=this.checkPossibleAlignments(this.el,d,h,this.options.coverTrigger?0:e.height),l="top",a=this.options.alignment;if(s+=this.options.coverTrigger?0:e.height,this.isScrollable=!1,r.top||(r.bottom?l="bottom":(this.isScrollable=!0,r.spaceOnTop>r.spaceOnBottom?(l="bottom",i+=r.spaceOnTop,s-=r.spaceOnTop):i+=r.spaceOnBottom)),!r[a]){let e="left"===a?"right":"left";r[e]?a=e:r.spaceOnLeft>r.spaceOnRight?(a="right",o+=r.spaceOnLeft,n-=r.spaceOnLeft):(a="left",o+=r.spaceOnRight)}return"bottom"===l&&(s=s-t.height+(this.options.coverTrigger?e.height:0)),"right"===a&&(n=n-t.width+e.width),{x:n,y:s,verticalAlignment:l,horizontalAlignment:a,height:i,width:o}}_animateIn(){t.remove(this.dropdownEl),t({targets:this.dropdownEl,opacity:{value:[0,1],easing:"easeOutQuad"},scaleX:[.3,1],scaleY:[.3,1],duration:this.options.inDuration,easing:"easeOutQuint",complete:e=>{this.options.autoFocus&&this.dropdownEl.focus(),"function"==typeof this.options.onOpenEnd&&this.options.onOpenEnd.call(this,this.el)}})}_animateOut(){t.remove(this.dropdownEl),t({targets:this.dropdownEl,opacity:{value:0,easing:"easeOutQuint"},scaleX:.3,scaleY:.3,duration:this.options.outDuration,easing:"easeOutQuint",complete:e=>{this._resetDropdownStyles(),"function"==typeof this.options.onCloseEnd&&this.options.onCloseEnd.call(this,this.el)}})}_placeDropdown(){let e=this.options.constrainWidth?this.el.getBoundingClientRect().width:this.dropdownEl.getBoundingClientRect().width;this.dropdownEl.style.width=e+"px";let t=this._getDropdownPosition();this.dropdownEl.style.left=t.x+"px",this.dropdownEl.style.top=t.y+"px",this.dropdownEl.style.height=t.height+"px",this.dropdownEl.style.width=t.width+"px",this.dropdownEl.style.transformOrigin=`${"left"===t.horizontalAlignment?"0":"100%"} ${"top"===t.verticalAlignment?"0":"100%"}`}open(){if(!this.isOpen){this.isOpen=!0;for(var e="#"+(o=this).id+" li",t=document.querySelectorAll(e),i=0;i<t.length;i++)t[i].addEventListener("click",function(e){e.preventDefault();for(var i=0;i<t.length;i++)t[i].classList.contains("active")&&t[i].classList.remove("active");this.classList.add("active")},!1);var o=this;this.options.onOpen&&this.executeFunctionByName(this.options.onOpen,window,o),this._resetDropdownStyles(),this.dropdownEl.style.display="block",this._placeDropdown(),this._animateIn(),this._setupTemporaryEventHandlers()}}close(){if(this.isOpen){this.isOpen=!1,this.focusedIndex=-1;this.options.onClose&&this.executeFunctionByName(this.options.onClose,window,this),this._animateOut(),this._removeTemporaryEventHandlers(),this.options.autoFocus&&this.el.focus()}}recalculateDimensions(){this.isOpen&&(this.$dropdownEl.css({width:"",height:"",left:"",top:"","transform-origin":""}),this._placeDropdown())}}n._dropdowns=[],j1.dropdowns=n,j1.jQueryLoaded=!!window.jQuery,j1.jQueryLoaded&&j1.initializeJqueryWrapper(n,"dropdown","M_Dropdown")}(cash,j1.anime);

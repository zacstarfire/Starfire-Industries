/*
 # -----------------------------------------------------------------------------
 # ~/assets/themes/j1/modules/lunr/js/jquery.lunr.search.js
 # jQuery plugin to use with J1LunrSearch
 #
 # Product/Info:
 # https://jekyll.one
 #
 # Copyright (C) 2023, 2024 Juergen Adams
 #
 # J1 Template is licensed under the MIT License.
 # See: https://github.com/jekyll-one-org/j1-template/blob/main/LICENSE.md
 # -----------------------------------------------------------------------------
 # TODO:
 # -----------------------------------------------------------------------------
*/
"use strict";!function(t){var e=function(t){var e=t.match(/(\d+)/g);return new Date(e[0],e[1]-1,e[2])},n=function(){function n(e,n){this.$elem=e,this.$results=t(n.results),this.indexData=n.index_file,this.template=this.compileTemplate(t(n.template)),this.titleMsg=n.titleMsg,this.emptyMsg=n.emptyMsg,this.onResultShown=n.onResultShown,this.initialize()}return n.prototype.initialize=function(){var e=this;this.loadIndexData(function(n){e.docs=t.map(n.docs,e.createEntry),e.index=lunr.Index.load(n.index),e.populateSearchFromQuery(),e.bindKeypress()})},n.prototype.compileTemplate=function(t){var e=t.text();return Mustache.parse(e),function(t,n){return Mustache.render(e,t,n)}},n.prototype.loadIndexData=function(e){t.getJSON(this.indexData,e)},n.prototype.createEntry=function(n,s){var i=t.extend({id:s+1},n);return n.date&&t.extend(i,{date:e(n.date),pubdate:function(){return dateFormat(e(n.date),"yyyy-mm-dd")},displaydate:function(){return dateFormat(e(n.date),"mmm dd, yyyy")}}),i},n.prototype.bindKeypress=function(){var t,e,n,s=this,i=this.$elem.val();this.$elem.bind("keyup",(t=function(){var t=s.$elem.val();t!==i&&s.search(t),i=t},n=Array.prototype.slice,function(){var s=n.call(arguments),i=this;clearTimeout(e),e=setTimeout(function(){t.apply(i,s)},100)}))},n.prototype.search=function(e){var n=this.docs;if(e.length<3)this.$results.hide().empty();else{var s=t.map(this.index.search(e),function(e){return t.grep(n,function(t){return t.id===parseInt(e.ref,10)})[0]});this.displayResults(s),this.onResultShown()}},n.prototype.displayResults=function(e){var n=this.$results;if(n.empty(),0===e.length?n.append(this.emptyMsg):(this.titleMsg&&0!==this.titleMsg.length&&n.append(this.titleMsg),n.append(this.template({docs:e}))),n.show(),e.length>0){var s,i;log4javascript.getLogger("j1.lunr").info("\npost cleanup of tags and categories"),t(".sr-tags").each(function(){i=t(this).html().replace(/^\s+(.*)(\s+·\s+$)/,"$1"),t(this).text(i)}),t(".sr-categories").each(function(){s=t(this).html().replace(/^(.*)(\s+·\s+$)/,"$1"),t(this).text(s)})}},n.prototype.populateSearchFromQuery=function(){var t=new URI(window.location.search.toString()).search(!0);t.hasOwnProperty("q")&&(this.$elem.val(t.q),this.search(t.q.toString()))},n}();t.fn.lunrSearch=function(e){return e=t.extend({},t.fn.lunrSearch.defaults,e),new n(this,e),this},t.fn.lunrSearch.defaults={index_file:"/assets/data/lunr-index.json",results:"#search-results",template:"#search-results-template",titleMsg:"<h1>Search results<h1>",emptyMsg:"<p>Nothing found.</p>",onResultShown:function(){}}}(jQuery);

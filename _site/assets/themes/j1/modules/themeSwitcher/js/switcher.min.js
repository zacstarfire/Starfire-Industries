/*
 # -----------------------------------------------------------------------------
 # ~/assets/themes/j1/modules/bsThemeSwitcher/js/switcher.js
 # Provides Javascript functions for Bootstrap ThemeSwitcher
 #
 # Product/Info:
 # https://jekyll.one
 # https://github.com/jguadagno/bootstrapThemeSwitcher
 #
 # Copyright (C) 2023, 2024 Juergen Adams
 # Copyright (C) 2014 Joseph Guadagno
 #
 # J1 Template is licensed under the MIT License.
 # See: https://github.com/jekyll-one-org/j1-template/blob/main/LICENSE.md
 # Bootstrap Theme Switcher is licensed under the MIT License.
 # See: https://github.com/jguadagno/bootstrapThemeSwitcher
 # -----------------------------------------------------------------------------
 # NOTE: This modules is MODIFIED to be used with MobileMenu (mmenuLight).
 #       The original version cannot be used with J1 for theme menu creation!
 # -----------------------------------------------------------------------------
*/
"use strict";!function(e,t,o,s){var n,i,a=j1.getCookieNames(),h=j1.findCookie("_ga"),r=j1.findCookie("j1"),c=new liteURL(t.location.href),l=c.hostname,m=(l.substring(l.lastIndexOf(".",l.lastIndexOf(".")-1)+1),!!c.protocol.includes("https")),d=log4javascript.getLogger("j1.themes.switcher"),u={},f=function(t,o){return this.$element=e(t),this.settings=e.extend({},e.fn.ThemeSwitcher.defaults,o),this.themesList=[],this.getThemes(),this};f.prototype={clear:function(){return d.debug("\nThemeSwitcher.clear"),this.$element.each(function(){this.$element.empty()})},update:function(){d.debug("\nThemeSwitcher.update"),this.getThemes()},checkStyleSheetByName:function(e){for(var t=!1,s=new RegExp("/"+e+"/","i"),n=0;n<o.styleSheets.length;n++)if(s.test(o.styleSheets[n].href)){t=!0;break}return t},switchTheme:function(t,o){var s=e(this),i=e.extend({},e.fn.ThemeSwitcher.defaults,s.data("ThemeSwitcher")),c=(i.cssThemeLink,i.debug);this.settings.includeBootswatch;if(j1.existsCookie(a.user_state)?(d.info("\ncookie found: "+a.user_state),n=j1.readCookie(a.user_state)):(d.error("\ncookie not found: "+a.user_state),d.info("\nj1 cookies found:"+r.length),r.forEach(function(e){console.log("j1.themes.switcher: "+e)}),d.info("\nga cookies found:"+h.length),h.forEach(function(e){console.log("j1.themes.switcher: "+e)})),n.theme_name,n.theme_css,void 0===o&&(o=this.settings.defaultCssFile),void 0===t&&(t=o),i.saveToCookie){if("undefined"==typeof Cookies)return"true"===c&&d.error("\ncookies library not present"),!1;n.theme_name=t,n.theme_css=o,n.theme_name.includes("Uno")||"Bootstrap"==n.theme_name?(n.theme_author="J1 Team",n.theme_author_url="https://jekyll.one/"):(n.theme_author="Bootswatch",n.theme_author_url="https://bootswatch.com/"),d.info("\nwrite to cookie : "+a.user_state),j1.writeCookie({name:a.user_state,data:n,secure:m,expires:365}),location.reload(!0)}else d.info("\nwrite to cookie : disabled"),d.warn("\nselected theme not activated: "+t)},loadThemeFromCookie:function(t){if("undefined"==typeof Cookies)return d.error("\ncookies library not present"),!1;e.extend({},e.fn.ThemeSwitcher.defaults,t);j1.existsCookie(a.user_state)?(d.info("\ncookie found: "+a.user_state),n=j1.readCookie(a.user_state)):(d.error("\ncookie not found: "+a.user_state),d.info("\nj1 cookies found:"+r.length),r.forEach(function(e){console.log("j1.themes.switcher: "+e)}),d.info("\nga cookies found:"+h.length),h.forEach(function(e){console.log("j1.themes.switcher: "+e)}));var o=n.theme_name,s=n.theme_css;this.switchTheme(o,s)},addTheme:function(e,t,o,s){void 0===o&&(o=0),void 0===s&&(s=0),this.themesList.splice(o,s,{name:e,css:t}),this.addThemesToControl()},addThemesToControl:function(){if(void 0===this.$element)return d.error("\nbootstrapThemeSelector|addThemesToControl: Element is undefined"),!1;if(void 0===this.themesList)return d.error("\nbootstrapThemeSelector|addThemesToControl: Themes is undefined"),!1;if(this.settings.excludeBootswatch){var t;-1!==this.settings.excludeBootswatch.indexOf(",")?t=this.settings.excludeBootswatch.replace(/ /g,"").split(","):(t=[]).push(this.settings.excludeBootswatch);var o=this.themesList;e.each(o,function(s,n){n&&n.name&&-1!==e.inArray(n.name,t)&&o.splice(s,1)}),this.themesList=o}var s=this;if(this.$element.is("ul")){var c,l=e(this),m=e.extend({},e.fn.ThemeSwitcher.defaults,l.data("ThemeSwitcher")),f=(m.cssThemeLink,m.debug);j1.existsCookie(a.user_state)?(d.info("\nuser state cookie found"),n=j1.readCookie(a.user_state)):(d.error("\nuser state NOT cookie found"),d.info("\nj1 cookies found:"+r.length),r.forEach(function(e){console.log("j1.themes.switcher: "+e)}),d.info("\nga cookies found:"+h.length),h.forEach(function(e){console.log("j1.themes.switcher: "+e)})),c=n.theme_name,"true"===f&&d.info("\nbootstrapThemeSelector: UL element selected"),this.$element.empty();var p="";e.each(this.themesList,function(t,o){p=s.$element[0].id.includes("mmenu")?"mmenu-item":"dropdown-item",o.name===c&&(p=s.$element[0].id.includes("mmenu")?"mmenu-item active":"dropdown-item active");var n=e("<li />").attr("class",p).append('<a class="link-no-decoration" href="#"><i class="mdib mdib-view-quilt mdib-18px mr-2" style="color: #9E9E9E"></i>'+o.name+"</a>").on("click",function(){m.loadFromBootswatch?s.switchTheme(o.name,o.css):s.switchTheme(o.name,o.cssCdn),e(this).parent().find("li").removeClass("active"),e(this).addClass("active")});s.$element.append(n)}),i=s.$element[0].className.includes("dropdown-menu")?"desktop":"mobile",u.type="state",u.action="menu loaded for : "+i,u.text="menu loaded on id: "+s.$element[0].id,j1.sendMessage("ThemeSwitcher","j1.adapter.navigator",u)}else if(this.$element.is("select")){var T;d.info("\nbootstrapThemeSelector: SELECT element selected"),this.$element.empty(),e.each(this.themesList,function(e,t){T=null,t.name===c&&(T="selected"),m.loadFromBootswatch?s.$element.append("<option "+T+" value='"+t.css+"'>"+t.name+"</option>"):s.$element.append("<option "+T+" value='"+t.cssCdn+"'>"+t.name+"</option>")}),this.$element.on("change",function(){var t=e("option:selected",this);s.switchTheme(t.text(),t.val())})}else d.info("\nbootstrapThemeSelector: no UL or SELECT element found"),d.error("\nbootstrapThemeSelector: failed")},getThemes:function(){var t=this;null!==this.settings.localFeed&&""!==this.settings.localFeed?e.ajax({url:this.settings.localFeed,dataType:"json",success:function(e){t.themesList=e.themes,t.addThemesToControl()},error:function(e,o,s){d.error("\nfailed to retrieve the local feed from: '"+t.settings.localFeed+"'")}}):e.ajax({url:this.settings.bootswatchApiUrl+"/"+this.settings.bootswatchApiVersion+".json",dataType:"json",success:function(e){if(void 0===e.themes)return null;t.themesList=e.themes,t.themesList.splice(0,0,{name:"default",css:t.settings.defaultCssFile}),t.addThemesToControl()}})},themes:function(e){if(void 0===e)return this.themesList;this.themesList=e}},e.fn.ThemeSwitcher=function(t){var o,s=Array.prototype.slice.call(arguments,1),n=e(this),i=n.data("ThemeSwitcher"),a="object"==typeof t&&t;return i||n.data("ThemeSwitcher",i=new f(this,a)),"string"==typeof t&&(o=i[t].apply(i,s)),void 0===o?n:o},e.fn.ThemeSwitcher.defaults={debug:!1,saveToCookie:!0,cssThemeLink:"bootstrapTheme",cookieThemeName:"bootstrapTheme.name",cookieThemeCss:"boostrapTheme.css",cookieExpiration:365,cookiePath:"/",defaultCssFile:"https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css",bootswatchApiUrl:"https://bootswatch.com/api/",bootswatchApiVersion:"5",loadFromBootswatch:!0,localFeed:"",excludeBootswatch:""},e.fn.ThemeSwitcher.Constructor=f}(jQuery,window,document);

/*
 # -----------------------------------------------------------------------------
 # ~/assets/themes/j1/modules/translator/js/translator.min.js
 # Provides JS Core functions|API for J1 Module Translator
 #
 #  Product/Info:
 #  http://jekyll.one
 #
 #  Copyright (C) 2023, 2024 Juergen Adams
 #
 #  J1 Theme is licensed under MIT License.
 #  See: https://github.com/jekyll-one/J1 Theme/blob/master/LICENSE
 # -----------------------------------------------------------------------------
*/

"use strict";function Translator(o){var e,a,t=this,n=log4javascript.getLogger("j1.core.translator"),i=!!new liteURL(window.location.href).protocol.includes("https"),r=(navigator.language||navigator.userLanguage,!1),s={},l={set:function(o,e,a,t,n,i){var r=window.btoa(e),s="; expires=Thu, 01 Jan 1970 00:00:00 UTC";if(a>0){var l=new Date;l.setTime(l.getTime()+24*a*60*60*1e3),s="; expires="+l.toUTCString()}document.cookie=i?n?o+"="+(r||"")+s+"; Path=/; SameSite="+t+"; Domain="+n+"; Secure="+i+";":o+"="+(r||"")+s+"; Path=/; SameSite="+t+"; Secure="+i+";":n?o+"="+(r||"")+s+"; Path=/; SameSite="+t+";Domain="+n+"; ":o+"="+(r||"")+s+"; Path=/; SameSite="+t+";"},get:function(o){for(var e=o+"=",a=document.cookie.split(";"),t=0;t<a.length;t++){for(var n=a[t];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(e)){var i=n.substring(e.length,n.length);return window.atob(i)}}}};for(var p in s.props={contentURL:"/assets/data/translator",translatorLanguagesFile:"/assets/data/iso-639-language-codes-flags.json",translatorLanguages:"translator-languages",cookieName:"j1.user.state",cookieConsentName:"j1.user.consent",cookieStorageDays:365,cookieSameSite:"Lax",cookieSecure:i,translationEnabled:!1,disableLanguageSelector:!1,translatorName:"google",translationLanguages:"all",translationLanguage:"auto",translateAllPages:!0,hideSuggestionBox:!0,hidePoweredBy:!0,hideTopFrame:!0,dialogLanguage:"auto",dialogLanguages:["en","de"],dialogContainerID:"translator-modal",xhrDataElement:"",postSelectionCallback:""},o)s.props[p]=o[p];-1!==s.props.dialogLanguage.indexOf("-")&&(s.props.dialogLanguage=s.props.dialogLanguage.split("-")[0]),s.props.dialogLanguages.includes(s.props.dialogLanguage)||(s.props.dialogLanguage="en"),s.props.xhrDataElement=s.props.xhrDataElement+"-"+s.props.dialogLanguage,n.info("\ninitializing core module: started"),n.debug("\nstate: started");l.get(s.props.cookieName)||(n.info("\ninitializing translator cookie: "+s.props.cookieName),l.set(s.props.cookieName,JSON.stringify({translatorName:"google",translationEnabled:!1,translateAllPages:!0,useLanguageFromBrowser:!0,translationLanguage:"de",analysis:!0,personalization:!0}),s.props.cookieStorageDays,s.props.cookieSameSite,s.props.cookieDomain,s.props.cookieSecure));var d=function(o){"loading"!==document.readyState?o():document.addEventListener("DOMContentLoaded",o)};function c(){var o={},e=!1,a=0,t=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(e=arguments[0],a++);for(var n=function(a){for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e&&"[object Object]"===Object.prototype.toString.call(a[t])?o[t]=c(!0,o[t],a[t]):o[t]=a[t])};a<t;a++){n(arguments[a])}return o}function g(o){var e,a=c({size:0,width:250,multiple:!1,selectedIndex:1,enableAutoFilter:!1,visibleRows:null},o);e="#"+a.selector,$.ajax({url:a.url,dataType:"json",success:function(o){var t=[];if(s.props.translationLanguages.includes("all"))t=o[a.elm];else for(var n=0;n<o[a.elm].length;n++)s.props.translationLanguages.includes(o[a.elm][n].value)&&t.push(o[a.elm][n]);a.visibleRows>t.length&&(a.visibleRows=t.length),void 0===$("#dropdownJSON")[0].msDropdown&&MsDropdown.make(e,{byJson:{data:t,name:a.name,size:a.size,width:a.width,multiple:a.multiple},enableAutoFilter:a.enableAutoFilter,visibleRows:a.visibleRows})},error:function(o,e,t){n.error("\nfailed to retrieve JSON data from: "+a.url)}})}function u(){var o="none";d(function(){if(t.modal=document.getElementById(s.props.dialogContainerID),t.modal)t.$modal.modal("show");else{n.info("\nload consent modal"),t.modal=document.createElement("div"),t.modal.id=s.props.dialogContainerID,t.modal.style.display="none",t.modal.setAttribute("class","modal fade"),t.modal.setAttribute("tabindex","-1"),t.modal.setAttribute("role","dialog"),t.modal.setAttribute("aria-labelledby",s.props.dialogContainerID),document.body.append(t.modal),t.$modal=$(t.modal),t.$modal.on("show.bs.modal",(function(){n.debug("\nshow.bs.modal: entered"),$.when(g({url:s.props.translatorLanguagesFile,elm:s.props.translatorLanguages,selector:"dropdownJSON",width:400,visibleRows:8})).then((function(o){n.info("\ncreating msDropdown from JSON data: finished")}))})),t.$modal.on("shown.bs.modal",(function(){var o,i;i=setInterval((function(){void 0!==document.getElementById("dropdownJSON").msDropdown&&((o=document.getElementById("dropdownJSON").msDropdown).length?("auto"===s.props.translationLanguage?(e=navigator.language||navigator.userLanguage,a=e.split("-")[0]):a=s.props.translationLanguage,o.selectedIndex=$("#dropdownJSON option[value="+a+"]").index(),s.props.disableLanguageSelector&&(o.disabled=!0),$("#dropdownJSON").show(),$("body").addClass("stop-scrolling"),n.info("\nmsDropdown successfully loaded in translation dialog"),clearInterval(i)):(n.error("\nno msDropdown found in translation dialog"),t.$modal.hide()))}),10)})),t.$modal.on("hidden.bs.modal",(function(){$("body").removeClass("stop-scrolling"),function(o,e){for(var a=Array.prototype.slice.call(arguments,2),t=o.split("."),n=t.pop(),i=0;i<t.length;i++)e=e[t[i]];e[n].apply(e,a)}(s.props.postSelectionCallback,window,o)}));var i=s.props.contentURL+"/index.html";$.get(i).done((function(e){n.info("\nloading consent modal: successfully"),t.modal.innerHTML=e,t.modal.innerHTML=$("#"+s.props.xhrDataElement).eq(0).html(),t.modal.style.display="block",$(t.modal).modal({backdrop:"static",keyboard:!1}),t.$buttonDoNotAgree=$("#translator-buttonDoNotAgree"),t.$buttonAgree=$("#translator-buttonAgree"),t.$buttonExit=$("#translator-buttonExit"),t.$buttonSave=$("#translator-buttonSave"),t.$buttonAgreeAll=$("#translator-buttonAgreeAll"),n.info("\nload/initialze options from cookie"),f(),m(),$("#google-options").on("hide.bs.collapse",(function(){r=!1,f()})).on("show.bs.collapse",(function(){r=!0,f()})),n.info("\ninitialze button event handler"),t.$buttonDoNotAgree.click((function(){var e;(e=b()).translationEnabled=!1,l.set(s.props.cookieName,JSON.stringify(e),s.props.cookieStorageDays,s.props.cookieSameSite,s.props.cookieDomain,s.props.cookieSecure),t.$modal.modal("hide"),o="process"})),t.$buttonAgree.click((function(){h(),o="process"})),t.$buttonExit.click((function(){o="exitOnly",t.$modal.modal("hide")})),t.$buttonSave.click((function(){var e,a;$("#google-options").collapse("hide"),e=b(),(a=JSON.parse(l.get(s.props.cookieConsentName))).analysis=e.analysis,a.personalization=e.personalization,l.set(s.props.cookieConsentName,JSON.stringify(a),s.props.cookieStorageDays,s.props.cookieSameSite,s.props.cookieDomain,s.props.cookieSecure),l.set(s.props.cookieName,JSON.stringify(e),s.props.cookieStorageDays,s.props.cookieSameSite,s.props.cookieDomain,s.props.cookieSecure),t.$modal.modal("hide"),m(),o="process"})),t.$buttonAgreeAll.click((function(){$("#google-options").collapse("hide"),h(),o="process"})),t.$modal.modal("show")})).fail((function(){n.error("\nloading translator dialog (modal): failed"),n.warn("\nprobably no|wrong `contentURL` set")}))}}.bind(this))}function m(){var o=t.getSettings();if(o)for(var e in o){t.$modal.find("#google-options .translator-option[data-name="+e+'] input[type="checkbox"]').prop("checked",o[e])}}function f(){r?(t.$buttonDoNotAgree.hide(),t.$buttonAgree.hide(),t.$buttonSave.show(),t.$buttonAgreeAll.show()):(t.$buttonDoNotAgree.show(),t.$buttonAgree.show(),t.$buttonSave.hide(),t.$buttonAgreeAll.hide())}function b(o){for(var e=t.$modal.find("#google-options .translator-option"),a={},n=0;n<e.length;n++){var i=e[n],r=i.getAttribute("data-name");if("necessary"===r)a[r]=!0;else if(void 0===o){var s=$(i).find('input[type="checkbox"]');a[r]=s.prop("checked")}else a[r]=!!o}return a}function h(){var o=JSON.parse(l.get(s.props.cookieConsentName)),e=JSON.parse(l.get(s.props.cookieName));e.analysis=!0,e.personalization=!0,e.translationEnabled=!0,o.analysis=e.analysis,o.personalization=e.personalization,l.set(s.props.cookieConsentName,JSON.stringify(o),s.props.cookieStorageDays,s.props.cookieSameSite,s.props.cookieDomain,s.props.cookieSecure),l.set(s.props.cookieName,JSON.stringify(e),s.props.cookieStorageDays,s.props.cookieSameSite,s.props.cookieDomain,s.props.cookieSecure),t.$modal.modal("hide")}this.showDialog=function(){u()},this.getSettings=function(o){if(l.get(s.props.cookieName)){var e=JSON.parse(l.get(s.props.cookieName));return void 0===o?e:!!e&&e[o]}},n.info("\ninitializing core module finished"),n.debug("\nstate: finished")}
